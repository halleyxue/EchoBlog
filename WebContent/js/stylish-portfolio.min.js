/*!
 * Start Bootstrap - Stylish Portfolio v5.0.1 (https://startbootstrap.com/template-overviews/stylish-portfolio)
 * Copyright 2013-2018 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-stylish-portfolio/blob/master/LICENSE)
 */

$("document").ready(function() {
		$("#headerpage").load("common.html");
		loadPoems("静夜思1");
	})
		
function loadPoems(name) {
	var content = {"name" : name};
	var json = {"jsonStr" : JSON.stringify(content)};
	$.post("../admin/getPoemByName.do", json, function(data) {
		var poem = JSON.parse(data.toString());
		var temp = "";
		var title = poem["title"];
		var remark = poem["remark"];
		var content = poem["content"];
		var str = content.split('。');
		for(var i = 0; i < str.length; i++){
			var substr = str[i].split('，');
			for(var j = 0; j < substr.length; j++){
				temp += "<p>" + substr[j] + "</p>";
			}
			if(i != str.length-1){
				temp += "</br>";
			}
		}
		document.getElementsByClassName("poem-title")[0].innerHTML = title;
		document.getElementsByClassName("poem-content")[0].innerHTML = temp;
		if(remark != null){
			document.getElementsByClassName("poem-meta")[0].innerHTML = remark;
		}

	}).fail(function(xhr, statusText, error) {
		alert(statusText + " " + error);
	});
}

!function(a) {
	"use strict";
	$.post("../admin/getCatalog.do", function(data) {
		var array = JSON.parse(data.toString());
		var temp = "<li class='sidebar-brand'><a class='js-scroll-trigger' >Start Bootstrap</a></li>";
		for(var i = 0; i < array.length; i++){
			temp += "<li class='sidebar-nav-item'><a class='js-scroll-trigger'>" + array[i] + "</a></li>";
		}
		
		document.getElementsByClassName("sidebar-nav")[0].innerHTML = temp;		
	}).fail(function(xhr, statusText, error) {
		alert(statusText + " " + error);
	});
	
	$("ul.sidebar-nav").on("click","li",function(){
		loadPoems($(this).text());
	})

	
	a(".menu-toggle").click(
			function(e) {
				e.preventDefault(),
						a("#sidebar-wrapper").toggleClass("active"),
						a(".menu-toggle > .fa-bars, .menu-toggle > .fa-times")
								.toggleClass("fa-bars fa-times"), a(this)
								.toggleClass("active")
			}), a('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(
			function() {
				if (location.pathname.replace(/^\//, "") == this.pathname
						.replace(/^\//, "")
						&& location.hostname == this.hostname) {
					var e = a(this.hash);
					if ((e = e.length ? e : a("[name=" + this.hash.slice(1)
							+ "]")).length)
						return a("html, body").animate({
							scrollTop : e.offset().top
						}, 1e3, "easeInOutExpo"), !1
				}
			}), a("#sidebar-nav-item").click(function(){
				alert("hello");
				loadPoems(document.getElementById("index").innerHTML);
			}),a("#sidebar-wrapper .js-scroll-trigger").click(
			  function() {
				a("#sidebar-wrapper").removeClass("active"), a(".menu-toggle")
						.removeClass("active"), a(
						".menu-toggle > .fa-bars, .menu-toggle > .fa-times")
						.toggleClass("fa-bars fa-times")
			}), a(document).scroll(
			function() {
				100 < a(this).scrollTop() ? a(".scroll-to-top").fadeIn() : a(
						".scroll-to-top").fadeOut()
			})
		
			
}(jQuery);

var onMapMouseleaveHandler = function(e) {
	var a = $(this);
	a.on("click", onMapClickHandler), a.off("mouseleave",
			onMapMouseleaveHandler), a.find("iframe").css("pointer-events",
			"none")
}, onMapClickHandler = function(e) {
	var a = $(this);
	a.off("click", onMapClickHandler), a.find("iframe").css("pointer-events",
			"auto"), a.on("mouseleave", onMapMouseleaveHandler)
};
$(".map").on("click", onMapClickHandler);